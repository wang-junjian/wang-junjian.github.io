---
layout: post
title:  "Vanna.AI"
date:   2024-07-04 08:00:00 +0800
categories: VannaAI TextToSQL
tags: [VannaAI, TextToSQL, SQLite, Qdrant, ChromaDB, Ollama]
---

## [Vanna å·¥ä½œåŸç†](https://vanna.ai/docs/index.html)

ä½¿ç”¨æ£€ç´¢å¢å¼ºæ¥å¸®åŠ©æ‚¨ä½¿ç”¨ LLM ä¸ºæ•°æ®åº“ç”Ÿæˆå‡†ç¡®çš„ SQL æŸ¥è¯¢ã€‚

![](/images/2024/VannaAI/how-vanna-works.jpg)

Vanna çš„å·¥ä½œè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªç®€å•æ­¥éª¤ - åœ¨æ‚¨çš„æ•°æ®ä¸Šè®­ç»ƒ RAGâ€œæ¨¡å‹â€ï¼Œç„¶åæå‡ºé—®é¢˜ï¼Œè¿™äº›é—®é¢˜å°†è¿”å› SQL æŸ¥è¯¢ï¼Œè¿™äº›æŸ¥è¯¢å¯ä»¥è®¾ç½®ä¸ºåœ¨æ‚¨çš„æ•°æ®åº“ä¸Šè‡ªåŠ¨è¿è¡Œã€‚

- vn.train(...)

    åœ¨æ‚¨çš„æ•°æ®ä¸Šè®­ç»ƒ RAGâ€œæ¨¡å‹â€ã€‚è¿™äº›æ–¹æ³•å°†æ·»åŠ åˆ°å‚è€ƒè¯­æ–™åº“ã€‚

- vn.ask(...)

    é—®é—®é¢˜ã€‚è¿™å°†ä½¿ç”¨å‚è€ƒè¯­æ–™åº“ç”Ÿæˆå¯ä»¥åœ¨æ‚¨çš„æ•°æ®åº“ä¸Šè¿è¡Œçš„ SQL æŸ¥è¯¢ã€‚


## ä¾‹å­
ä¸æ‚¨çš„ SQL æ•°æ®åº“èŠå¤© ğŸ“Šã€‚é€šè¿‡ RAG ä½¿ç”¨ LLM å®ç°å‡†ç¡®çš„æ–‡æœ¬åˆ° SQL ç”Ÿæˆ ğŸ”„ã€‚

### ChromaDB & Ollama
```py
from vanna.ollama import Ollama
from vanna.chromadb import ChromaDB_VectorStore


class MyVanna(ChromaDB_VectorStore, Ollama):
    def __init__(self, config=None):
        ChromaDB_VectorStore.__init__(self, config=config)
        Ollama.__init__(self, config=config)


vn = MyVanna(config={'model': 'qwen2:7b'})
vn.connect_to_sqlite('https://vanna.ai/Chinook.sqlite')

# Training
df_ddl = vn.run_sql("SELECT type, sql FROM sqlite_master WHERE sql is not null")

for ddl in df_ddl['sql'].to_list():
  vn.train(ddl=ddl)

# The following are methods for adding training data. Make sure you modify the examples to match your database.

# DDL statements are powerful because they specify table names, colume names, types, and potentially relationships
vn.train(ddl="""
    CREATE TABLE IF NOT EXISTS my-table (
        id INT PRIMARY KEY,
        name VARCHAR(100),
        age INT
    )
""")

# Sometimes you may want to add documentation about your business terminology or definitions.
vn.train(documentation="Our business defines OTIF score as the percentage of orders that are delivered on time and in full")

# You can also add SQL queries to your training data. This is useful if you have some queries already laying around. You can just copy and paste those from your editor to begin generating new SQL.
vn.train(sql="SELECT * FROM my-table WHERE name = 'John Doe'")
# At any time you can inspect what training data the package is able to reference
training_data = vn.get_training_data()

# You can remove training data if there's obsolete/incorrect information. 
vn.remove_training_data(id='1-ddl')

# ```## Asking the AI
# Whenever you ask a new question, it will find the 10 most relevant pieces of training data and use it as part of the LLM prompt to generate the SQL.
# ```python
vn.ask(question=...)
```

- [Generating SQL for SQLite using Ollama, ChromaDB](https://vanna.ai/docs/sqlite-ollama-chromadb/)

å¯åŠ¨ UI

```py
Launch the User Interface
from vanna.flask import VannaFlaskApp
app = VannaFlaskApp(vn)
app.run()
```

- [Chinook Database](https://github.com/lerocha/chinook-database)

### Qdrant & Ollama
```py
from vanna.ollama import Ollama
from vanna.qdrant import Qdrant_VectorStore
from qdrant_client import QdrantClient


class MyVanna(Qdrant_VectorStore, Ollama):
    def __init__(self, config=None):
        Qdrant_VectorStore.__init__(self, config=config)
        Ollama.__init__(self, config=config)


qdrant_memory_client = QdrantClient(":memory:")

vn = MyVanna(
    config={
        'client': qdrant_memory_client, 
        'fastembed_model': 'BAAI/bge-small-zh-v1.5',
        'model': 'qwen2:7b'
    }
)

vn.connect_to_sqlite('https://vanna.ai/Chinook.sqlite')

df_ddl = vn.run_sql("SELECT type, sql FROM sqlite_master WHERE sql is not null")
for ddl in df_ddl['sql'].to_list():
    vn.train(ddl=ddl)

from vanna.flask import VannaFlaskApp
app = VannaFlaskApp(vn)
app.run()
```

- [Generating SQL for SQLite using Ollama, Qdrant](https://vanna.ai/docs/sqlite-ollama-qdrant/)
