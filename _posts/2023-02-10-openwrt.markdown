---
layout: post
title:  "OpenWrt"
date:   2023-02-10 08:00:00 +0800
categories: 路由器
tags: [OpenWrt, vsftpd, FileZilla]
---

## DIY自己的软路由系统
### [LEDE](https://github.com/coolsnowwolf/lede)
我买了一个使用 Intel 赛扬处理器的路由器。主要是为了搭梯子，2020年的时候网上编译好的系统不支持 TROJAN 协议，所以我自己使用 LEDE 编译。他的 **SSR Plus+** 组件支持 **SS/SSR/V2RAY/TROJAN** 等协议.

* Images built after May 31 2020 are based on Ubuntu 18.04. 
* ```x86``` This image has **26G**, and the dependent software packages and compiled binaries are in it. It can be used directly for x86, or it can be recompiled through simple configuration.
* ```x86-bin``` This image contains only x86 binaries generated by compilation.

### Compile your own LEDE system.
* Compile:
```bash
docker run -it --name=lede gouchicao/lede:x86
git pull
./scripts/feeds update -a && ./scripts/feeds install -a
make defconfig
make -j$(($(nproc) + 1)) download
make -j$(($(nproc) + 1)) V=s
```

* Reconfiguration:
```bash
rm -rf ./tmp && rm -rf .config
make menuconfig
make -j$(($(nproc) + 1)) V=s
```

* Output path after compilation: **/lede/bin/targets**

### Docker Hub
[我编译的 LEDE](https://hub.docker.com/r/gouchicao/lede)


## SSH 登录 OpenWrt
出现不能访问的错误。
```shell
ssh root@192.168.1.3
```
```
Unable to negotiate with 192.168.1.3 port 22: no matching host key type found. Their offer: ssh-rsa
```

解决方法：
```shell
ssh -oHostKeyAlgorithms=+ssh-rsa root@192.168.1.3                                                
```
```
The authenticity of host '192.168.1.3 (192.168.1.3)' can't be established.
RSA key fingerprint is SHA256:uRfnrNqqCf8TIQ6qvZqFKdAYUthnB3wgiOpvPkHfJHk.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.1.3' (RSA) to the list of known hosts.
root@192.168.1.3's password: 


BusyBox v1.30.0 () built-in shell (ash)

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 OpenWrt SNAPSHOT, r2561-ef2ebeee
 -----------------------------------------------------
root@OpenWrt:~# 
```

每次都像上面那样输出，太麻烦了。可以在客户端进行配置。
```shell
vim ~/.ssh/config
```
```
Host openwrt
    Hostname 192.168.1.3
    HostKeyAlgorithms +ssh-rsa
    User root
```

方便快捷的登录方法
```shell
ssh openwrt
```

现在还有一点点遗憾，不能免密登录。OpenWrt 的 SSH 服务端使用的是 Dropbear，通过后台管理配置了 ssh-key 密钥，服务器上可以看到文件：/etc/dropbear/authorized_keys。
**没有免密成功**


## FTP 客户端 [FileZilla](https://filezilla-project.org/index.php)
OpenWrt 上的 FTP 服务器是 vsftpd。
* 配置路径：/etc/config/vsftpd
* 服务路径：/etc/init.d/vsftpd

### 解决在客户端不能删除服务器上的目录
* 连接后删除服务器上目录出现错误信息：“550 Remove directory operation failed.”
* 登录 OpenWrt 的后台管理，通过菜单【网络存储】-【FTP 服务器】，在全局设置中选择“显示以点开头的文件 (隐藏文件)”。
* 单击【保存&应用】。

[Enable display of hidden dot files in VSFTPD](https://www.shkodenko.com/enable-display-of-hidden-dot-files-in-vsftpd/)
